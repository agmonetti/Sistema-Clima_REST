<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<main class="main-content">
    <div class="container">
        <div class="page-header">
            <h1>üìù Solicitar Proceso</h1>
            <a href="/procesos" class="btn btn-outline">‚Üê Volver</a>
        </div>

        <div class="form-container">
            <div class="process-info-card">
                <h2><%= proceso.nombre %></h2>
                <p class="process-description"><%= proceso.descripcion || 'Sin descripci√≥n' %></p>
                <p class="process-cost"><strong>Costo:</strong> $<%= proceso.costo %></p>
                <p class="process-code"><strong>C√≥digo:</strong> <code><%= proceso.codigo %></code></p>
            </div>

            <form action="/procesos/solicitar" method="POST" class="form-card">
                <input type="hidden" name="procesoId" value="<%= proceso._id %>">
                
                <h3>Par√°metros del Proceso</h3>
                
                <% if (['INFORME_MAXIMAS_MINIMAS', 'INFORME_PROMEDIOS', 'ANALISIS_DESVIACION', 'CONSULTAR_DATOS', 'BUSCAR_ALERTAS', 'CHECK_SALUD'].includes(proceso.codigo)) { %>
                <div class="form-group">
                    <label for="sensorId">Sensor *</label>
                    <select name="sensorId" id="sensorId" required class="form-control">
                        <option value="">Seleccionar sensor...</option>
                        <% sensores.forEach(function(s) { %>
                        <option value="<%= s._id %>"><%= s.nombre %> (<%= s.ubicacion?.ciudad || 'N/A' %>)</option>
                        <% }); %>
                    </select>
                </div>
                <% } %>

                <% if (['INFORME_MAXIMAS_MINIMAS', 'INFORME_PROMEDIOS', 'ANALISIS_DESVIACION', 'BUSCAR_ALERTAS'].includes(proceso.codigo)) { %>
                <div class="form-row">
                    <div class="form-group">
                        <label for="fechaInicio">Fecha Inicio *</label>
                        <input type="date" id="fechaInicio" name="fechaInicio" required class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="fechaFin">Fecha Fin *</label>
                        <input type="date" id="fechaFin" name="fechaFin" required class="form-control">
                    </div>
                </div>
                <% } %>

                <% if (proceso.codigo === 'BUSCAR_ALERTAS') { %>
                <div class="form-row">
                    <div class="form-group">
                        <label for="variable">Variable</label>
                        <select name="variable" id="variable" class="form-control">
                            <option value="temperatura">Temperatura</option>
                            <option value="humedad">Humedad</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="umbral">Umbral *</label>
                        <input type="number" id="umbral" name="umbral" required step="any" 
                               placeholder="Ej: 30" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="operador">Operador</label>
                        <select name="operador" id="operador" class="form-control">
                            <option value="mayor">Mayor que</option>
                            <option value="menor">Menor que</option>
                        </select>
                    </div>
                </div>
                <% } %>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        Solicitar Proceso ($<%= proceso.costo %>)
                    </button>
                    <a href="/procesos" class="btn btn-secondary">Cancelar</a>
                </div>
            </form>
        </div>
    </div>
</main>

<%- include('../partials/footer') %>
